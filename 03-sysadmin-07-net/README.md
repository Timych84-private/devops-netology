# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

    Linux:
    ```bash
    root@vagrant:~# ip link show
        1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
            link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
            link/ether 08:00:27:a2:6b:fd brd ff:ff:ff:ff:ff:ff
        3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
            link/ether 08:00:27:49:7c:ea brd ff:ff:ff:ff:ff:ff
    ```
    Windows:

    ```bash
    C:\Users\Timur>ipconfig

    Настройка протокола IP для Windows
   
    Адаптер Ethernet VMware Network Adapter VMnet1:

    DNS-суффикс подключения . . . . . :
    Локальный IPv6-адрес канала . . . : fe80::844b:b537:8066:2558%2
    IPv4-адрес. . . . . . . . . . . . : 192.168.112.1
    Маска подсети . . . . . . . . . . : 255.255.255.0
    Основной шлюз. . . . . . . . . :

    Адаптер Ethernet VMware Network Adapter VMnet8:

    DNS-суффикс подключения . . . . . :
    Локальный IPv6-адрес канала . . . : fe80::6cef:14b1:8768:2085%5
    IPv4-адрес. . . . . . . . . . . . : 192.168.171.1
    Маска подсети . . . . . . . . . . : 255.255.255.0
    Основной шлюз. . . . . . . . . :

    Адаптер беспроводной локальной сети Беспроводная сеть:

    DNS-суффикс подключения . . . . . :
    IPv4-адрес. . . . . . . . . . . . : 192.168.0.22
    Маска подсети . . . . . . . . . . : 255.255.255.0
    Основной шлюз. . . . . . . . . : 192.168.0.1

    ```

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?
   
    Для распознования соседа по сетевому интерфейсу используется протокол LLDP.
    В linux для работы с lldp есть пакет lldpd. В пакете есть утилита lldpcli

    ```bash
    root@vagrant:~# lldpcli show neighbors
    -------------------------------------------------------------------------------
    LLDP neighbors:
    -------------------------------------------------------------------------------
    Interface:    eth1, via: LLDP, RID: 1, Time: 0 day, 00:08:48
    Chassis:
        ChassisID:    mac d4:5d:64:3c:ea:54
    Port:
        PortID:       mac d4:5d:64:3c:ea:54
        TTL:          3601
    -------------------------------------------------------------------------------
    Interface:    eth1, via: LLDP, RID: 2, Time: 0 day, 00:01:29
    Chassis:
        ChassisID:    mac d8:5e:d3:a3:1a:11
    Port:
        PortID:       mac d8:5e:d3:a3:1a:11
        TTL:          3601
    -------------------------------------------------------------------------------
    ```

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.
    
    Для разделения L2 коммутатора на несколько виртуальных сетей используется технология VLAN
    
    Один из вариантов настройки через netplan:

    ```bash
    network:
    ethernets:
        ens33:
        dhcp4: true
        ens37: {}
    vlans:
        vlan.101:
            dhcp4: no
            id: 101
            link: ens37
            addresses: [10.0.0.16/24]
    version: 2
    ```
    Еще вариант настройки через ip:
    ```bash
    ip link add link ens37 name ens37.101 type vlan id 101
    ip addr add 10.0.0.16/24 dev ens37.101
    ```
4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

    есть 7 режимов bonding в Linux:
    - 0 — balance-rr — (round-robin) — режим циклического выбора активного интерфейса для исходящего трафика (рекомендован для включения по умолчанию, не требует применения специальных коммутаторов);
   - 1 — active-backup — активен только один интерфейс, остальные в режиме горячей замены (самый простой режим, работает с любым оборудованием, не требует применения специальных коммутаторов);
   - 2 — balance-xor — режим, в котором каждый получатель закрепляется за одним из физических интерфейсов, который выбирается по специальной формуле (не требует применения специальных коммутаторов);
   - 3 — broadcast — трафик идет через все интерфейсы одновременно (примитивный и потенциально конфликтный режим);
   - 4 — 802.3ad — (dynamic link aggregation) — в группу объединяются одинаковые по скорости и режиму интерфейсы. Все физические интерфейсы используются одновременно в соответствии со спецификацией IEEE 802.3ad. Для реализации этого режима необходима поддержка на уровне драйверов сетевых карт и коммутатор, поддерживающий стандарт IEEE 802.3ad (коммутатор требует отдельной настройки);
   - 5 — balance-tlb — (adaptive transmit load balancing) — исходящий трафик распределяется в соответствии с текущей нагрузкой (с учетом скорости) на интерфейсах (для данного режима необходима его поддержка в драйверах сетевых карт);
   - 6 — balance-alb — (adaptive load balancing) — включает в себя balance-tlb, плюс балансировку на приём (rlb) для IPv4 трафика и не требует применения специальных коммутаторов (балансировка на приём достигается на уровне протокола ARP, перехватом ARP ответов локальной системы и перезаписью физического адреса на адрес одного из сетевых интерфейсов, в зависимости от загрузки).
    
    Пример конфигурации  в режиме active-backup

    ```bash
    network:
    ethernets:
        ens33:
        dhcp4: true
        ens37: {}
        ens38: {}
    bonds:
        bond0:
        interfaces: [ens37, ens38]
        mtu: 9000
        parameters:
            mode: active-backup
            mii-monitor-interval: 1
    vlans:
        bond.101:
            dhcp4: no
            id: 101
            link: bond0
            addresses: [10.0.0.16/24]
    version: 2
    ```


5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.
    - В сети с маской /29 8 айпи адресов (с учетом network и broadcast)
    - В сети с маской /24 256 адресов (с учетом network и broadcast) поместится 32 сети с маской /29
    - Примеры 10.10.10.0/29, 10.10.10.8/29, 10.10.10.16/29 и т.д.
- Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.
    
    Можно попробовать использовать следующую подсеть:\
    100.64.0.0/10\
    Как вариант 100.64.0.0/26 даст 62 хоста


7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?
    
    Linux:
    - показать arp таблицу: `ip neigh show` или с пакетом arp `arp -a`\
    - очистить arp кеш: `ip -s -s neigh flush all` или по одному через `arp -d 192.168.1.1`
    - удалить один ip: `ip neigh del 192.168.1.1 dev ens38` или `arp -d 192.168.1.1`

    Windows:
   - показать arp таблицу: `arp -a`\
   - очистить arp кеш: `arp -d` 
   - удалить один ip:  `arp -d 192.168.1.1`